<!DOCTYPE html>
<!-- this file is auto-generated from threejs/lessons/ja/threejs-post-processing-3dlut.md. Do not edited directly -->
<!--
Copyright 2018, Google Inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Google Inc. nor the names of their
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Three.jsで3DLUTポストプロセスを実装する方法">
<meta name="keywords" content="webgl graphics three.js">
<meta name="thumbnail" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-post-processing-3dlut_ja.jpg">

<meta property="og:title" content="Three.jsの3DLUTポストプロセス">
<meta property="og:type" content="website">
<meta property="og:image" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-post-processing-3dlut_ja.jpg">
<meta property="og:description" content="Three.jsで3DLUTポストプロセスを実装する方法">
<meta property="og:url" content="https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="threejsfundamentals.org">
<meta name="twitter:title" content="Three.jsの3DLUTポストプロセス">
<meta name="twitter:url" content="https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html">
<meta name="twitter:description" content="Three.jsで3DLUTポストプロセスを実装する方法">
<meta name="twitter:image:src" content="https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-post-processing-3dlut_ja.jpg">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/threejs/lessons/threejs-post-processing-3dlut.html">
  <link rel="alternate" hreflang="fr" href="https://webglfundamentals.org/threejs/lessons/fr/threejs-post-processing-3dlut.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html">
  <link rel="alternate" hreflang="kr" href="https://webglfundamentals.org/threejs/lessons/kr/threejs-post-processing-3dlut.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/threejs/lessons/ru/threejs-post-processing-3dlut.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/threejs/lessons/zh_cn/threejs-post-processing-3dlut.html">




<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://threejsfundamentals.org/#website",
      "url":"https://threejsfundamentals.org/",
      "name":"ThreejsFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html#primaryimage",
      "url":"https://threejsfundamentals.org/threejs/lessons/screenshots/threejs-post-processing-3dlut_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html#webpage",
      "url":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html",
      "inLanguage":"ja",
      "name":"Three.jsの3DLUTポストプロセス",
      "keywords":"webgl graphics three.js programming",
      "isPartOf":{
        "@id":"https://threejsfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://threejsfundamentals.org/threejs/lessons/ja/threejs-post-processing-3dlut.html#primaryimage"
      }
    }
  ]
}
</script>

<title>Three.jsの3DLUTポストプロセス</title>
<link href="/threejs/lessons/resources/threejsfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="apple-touch-icon" href="/threejs/lessons/resources/threejsfundamentals-icon.png">
<link rel="icon" href="/threejs/lessons/resources/threejsfundamentals-icon.png">

<link rel="stylesheet" href="/threejs/lessons/lang.css">
<link rel="stylesheet" href="/threejs/lessons/resources/lesson.css">
</head>
<body>
<div class="threejs_navbar">
  <div>
    <select class="language">
    <option value="/threejs/lessons/threejs-post-processing-3dlut.html" >English</a>
    <option value="/threejs/lessons/fr/threejs-post-processing-3dlut.html" >Français</a>
    <option value="/threejs/lessons/ja/threejs-post-processing-3dlut.html" selected>日本語</a>
    <option value="/threejs/lessons/kr/threejs-post-processing-3dlut.html" >한국어</a>
    <option value="/threejs/lessons/ru/threejs-post-processing-3dlut.html" >Русский</a>
    <option value="/threejs/lessons/zh_cn/threejs-post-processing-3dlut.html" >中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="threejs_header">
  <h1><a href="/threejs/lessons/ja/">threejsfundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/threejsfundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>Three.jsの3DLUTポストプロセス</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>前回の記事では<a href="threejs-post-processing.html">ポストプロセス</a>の説明をしました。
ポストプロセスの一般的な方法の1つにLUT（ラット）や3DLUT（3次元ラット）と呼ばれるものがあります。
LUTはルックアップテーブル（参照対応表）の略です。したがって、3DLUTは3次元のルックアップテーブルです。</p>
<p>3DLUTがどのように機能するかというとカラーのキューブを作ります。
元となる画像のカラーを使い、キューブにインデックスを作成します。
元画像の各ピクセルに対して、赤、緑、青のカラーに基づいてキューブの位置を調べます。
キューブの位置が3DLUTから引き出した新しいカラーとなります。</p>
<p>Javascriptでは次のようにします。
カラーは0〜255までの整数で指定されており、サイズが256 x 256 x 256の大きな3次元配列があると想像して下さい。
ルックアップテーブルを通してカラーを変換します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">const newColor = lut[origColor.red][origColor.green][origColor.bue]
</code></pre><p>もちろん、256 x 256 x 256の配列はかなり大きいですが、<a href="threejs-textures.html">テクスチャの記事</a>で指摘したようにテクスチャの寸法に関係なく0.0～1.0の値を参照します。</p>
<p>8 × 8 × 8のキューブを想像してみましょう。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-rgb.svg" class="noinvertdark" style="width: 500px"></div>

<p>最初に0, 0, 0の位置の角は黒にし、反対の1, 1, 1の角は白にします。
1, 0, 0は<span style="color:red;">赤</span>です。
0, 1, 0は<span style="color:green;">緑</span>で0, 0, 1は<span style="color:blue;">青</span>にします。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-axis.svg" class="noinvertdark" style="width: 500px"></div>

<p>各軸線にカラーを追加していきます。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-edges.svg" class="noinvertdark" style="width: 500px"></div>

<p>2チャンネル以上を使用するエッジのカラーです。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-standard.svg" class="noinvertdark" style="width: 500px"></div>

<p>最後に中間にあるカラーも全て埋めます。
これは&quot;同一性&quot;の3DLUTです。入力と全く同じ出力を生成します。
もし色を入力して調べれば、入力と同じカラーが出力されます。</p>
<div class="threejs_center"><object type="image/svg+xml" data="resources/images/3dlut-standard-lookup.svg" class="noinvertdark" data-diagram="lookup" style="width: 600px"></object></div>

<p>キューブをシェーダーで琥珀色に変更し3Dルックアップテーブルの同じ場所を調べると、異なる出力が得られます。</p>
<div class="threejs_center"><object type="image/svg+xml" data="resources/images/3dlut-amber-lookup.svg" class="noinvertdark" data-diagram="lookup" style="width: 600px"></object></div>

<p>別のルックアップテーブルを提供してこの技術を使用すると、全種類の効果を適用できます。
基本的には単一のカラー入力のみを計算できる効果です。
これらの効果には色相、コントラスト、彩度、カラーキャスト、色合い、明るさ、露出、レベル、カーブ、ポスタライズ、シャドウ、ハイライト、その他多くの調整が含まれます。
これが優れている点は全て1つのルックアップテーブルにまとめられてます。</p>
<p>これを使用するには適用するシーンが必要です。
ちょっとしたシーンにこれを適用してみましょう。
まずは<a href="threejs-load-gltf.html">glTFを読み込む記事</a>で取り上げたようにglTFファイルを表示する所から始めてみます。
載せているモデルは<a href="https://sketchfab.com/sarath.irn.kat005">氷の狼</a>の<a href="https://sketchfab.com/models/a1d315908e9f45e5a3bc618bdfd2e7ee">このモデル</a>です。
ライトは使わないので削除しました。</p>
<p><a href="threejs-backgrounds.html">背景とスカイボックス</a>で説明したような背景画像も追加します。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-postprocessing-3dlut-prep.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-postprocessing-3dlut-prep.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>シーンがあるので3DLUTが必要です。
最も単純な3DLUTは2 x 2 x 2の同一性LUTです。<em>同一性</em>とは何も起こらない事を意味します。
1を掛けるようなもので、LUTでカラーを調べているにも関わらず、入力カラーと同じ出力カラーがマップされてます。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-standard-2x2.svg" class="noinvertdark" style="width: 200px"></div>

<p>WebGL1は3Dテクスチャは非サポートのため、4 x 2の2Dテクスチャを使用しカスタムシェーダーの中で3Dテクスチャとして扱います。
カスタムシェーダーではキューブの各切片がテクスチャ全体に水平に広がっています。</p>
<p>以下はidentityLUTに必要なカラーで4 x 2の2Dテクスチャを作るコードです。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const makeIdentityLutTexture = function() {
  const identityLUT = new Uint8Array([
      0,   0,   0, 255,  // black
    255,   0,   0, 255,  // red
      0,   0, 255, 255,  // blue
    255,   0, 255, 255,  // magenta
      0, 255,   0, 255,  // green
    255, 255,   0, 255,  // yellow
      0, 255, 255, 255,  // cyan
    255, 255, 255, 255,  // white
  ]);

  return function(filter) {
    const texture = new THREE.DataTexture(identityLUT, 4, 2, THREE.RGBAFormat);
    texture.minFilter = filter;
    texture.magFilter = filter;
    texture.needsUpdate = true;
    texture.flipY = false;
    return texture;
  };
}();
</code></pre>
<p>フィルターをかけたテクステャ、かけていないテクステャの2つを作ります。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutTextures = [
  { name: &#39;identity&#39;, size: 2, texture: makeIdentityLutTexture(THREE.LinearFilter) },
  { name: &#39;identity not filtered&#39;, size: 2, texture: makeIdentityLutTexture(THREE.NearestFilter) },
];
</code></pre>
<p><a href="threejs-post-processing.html">ポストプロセスの記事</a>のカスタムシェーダーを使った例を参考に、2つのカスタムシェーダーを使ってみましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutShader = {
  uniforms: {
    tDiffuse: { value: null },
    lutMap:  { value: null },
    lutMapSize: { value: 1, },
  },
  vertexShader: `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  `,
  fragmentShader: `
    #include &lt;common&gt;

    #define FILTER_LUT true

    uniform sampler2D tDiffuse;
    uniform sampler2D lutMap;
    uniform float lutMapSize;

    varying vec2 vUv;

    vec4 sampleAs3DTexture(sampler2D tex, vec3 texCoord, float size) {
      float sliceSize = 1.0 / size;                  // space of 1 slice
      float slicePixelSize = sliceSize / size;       // space of 1 pixel
      float width = size - 1.0;
      float sliceInnerSize = slicePixelSize * width; // space of size pixels
      float zSlice0 = floor( texCoord.z * width);
      float zSlice1 = min( zSlice0 + 1.0, width);
      float xOffset = slicePixelSize * 0.5 + texCoord.x * sliceInnerSize;
      float yRange = (texCoord.y * width + 0.5) / size;
      float s0 = xOffset + (zSlice0 * sliceSize);

      #ifdef FILTER_LUT

        float s1 = xOffset + (zSlice1 * sliceSize);
        vec4 slice0Color = texture2D(tex, vec2(s0, yRange));
        vec4 slice1Color = texture2D(tex, vec2(s1, yRange));
        float zOffset = mod(texCoord.z * width, 1.0);
        return mix(slice0Color, slice1Color, zOffset);

      #else

        return texture2D(tex, vec2( s0, yRange));

      #endif
    }

    void main() {
      vec4 originalColor = texture2D(tDiffuse, vUv);
      gl_FragColor = sampleAs3DTexture(lutMap, originalColor.xyz, lutMapSize);
    }
  `,
};

const lutNearestShader = {
  uniforms: {...lutShader.uniforms},
  vertexShader: lutShader.vertexShader,
  fragmentShader: lutShader.fragmentShader.replace(&#39;#define FILTER_LUT&#39;, &#39;//&#39;),
};
</code></pre>
<p>フラグメントシェーダーの中に次のような行があるのが分かります。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#define FILTER_LUT true
</code></pre>
<p>2番目のシェーダーを生成するためにその行をコメントアウトします。</p>
<p>これらを使用して2つのカスタムエフェクトを作成します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const effectLUT = new THREE.ShaderPass(lutShader);
effectLUT.renderToScreen = true;
const effectLUTNearest = new THREE.ShaderPass(lutNearestShader);
effectLUTNearest.renderToScreen = true;
</code></pre>
<p>背景を別のシーンに描画する既存コードを変更し、glTFと背景を描画するシーンの両方に <code class="notranslate" translate="no">RenderPass</code> を適用します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const renderModel = new THREE.RenderPass(scene, camera);
renderModel.clear = false;  // so we don&#39;t clear out the background
const renderBG = new THREE.RenderPass(sceneBG, cameraBG);
</code></pre>
<p>全てのパスを使用するように <code class="notranslate" translate="no">EffectComposer</code> を設定できます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const rtParameters = {
  minFilter: THREE.LinearFilter,
  magFilter: THREE.LinearFilter,
  format: THREE.RGBFormat,
};
const composer = new THREE.EffectComposer(renderer, new THREE.WebGLRenderTarget(1, 1, rtParameters));

composer.addPass(renderBG);
composer.addPass(renderModel);
composer.addPass(effectLUT);
composer.addPass(effectLUTNearest);
</code></pre>
<p>LUTを選択するためのGUIコードを作ってみましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutNameIndexMap = {};
lutTextures.forEach((info, ndx) =&gt; {
  lutNameIndexMap[info.name] = ndx;
});

const lutSettings = {
  lut: lutNameIndexMap.identity,
};
const gui = new GUI({ width: 300 });
gui.add(lutSettings, &#39;lut&#39;, lutNameIndexMap);
</code></pre>
<p>最後にfilterするかに応じてeffectをオンにし、選択したテクスチャを使用するようにeffectを設定して、<code class="notranslate" translate="no">EffectComposer</code> を通してレンダリングします。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutInfo = lutTextures[lutSettings.lut];

const effect = lutInfo.filter ? effectLUT : effectLUTNearest;
effectLUT.enabled = lutInfo.filter;
effectLUTNearest.enabled = !lutInfo.filter;

const lutTexture = lutInfo.texture;
effect.uniforms.lutMap.value = lutTexture;
effect.uniforms.lutMapSize.value = lutInfo.size;

composer.render(delta);
</code></pre>
<p>同一性の3DLUTである事を考えると何も変わりません。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-postprocessing-3dlut-identity.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-postprocessing-3dlut-identity.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>しかし、GUIでidentity not filteredを選択すると興味深い結果になります。</p>
<div class="threejs_center"><img src="../resources/images/unfiltered-3dlut.jpg" style="width: 500px"></div>

<p>なぜこのようなことが起こるのでしょうか？
filterをオンにするとGPUはカラーの中間を線形補間します。
filterをオフにすると補間は行わなわれず、3DLUT内のカラーを探しても3DLUT内の正確なカラーの1つしか得られません。</p>
<p>もっと面白い3DLUTを作るにはどうすれば良いでしょうか？</p>
<p>まず必要なテーブルの解像度を決定し、簡単なスクリプトを使用しルックアップキューブの切片を生成します。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const ctx = document.querySelector(&#39;canvas&#39;).getContext(&#39;2d&#39;);

function drawColorCubeImage(ctx, size) {
  const canvas = ctx.canvas;
  canvas.width = size * size;
  canvas.height = size;

  for (let zz = 0; zz &lt; size; ++zz) {
    for (let yy = 0; yy &lt; size; ++yy) {
      for (let xx = 0; xx &lt; size; ++xx) {
        const r = Math.floor(xx / (size - 1) * 255);
        const g = Math.floor(yy / (size - 1) * 255);
        const b = Math.floor(zz / (size - 1) * 255);
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fillRect(zz * size + xx, yy, 1, 1);
      }
    }
  }
  document.querySelector(&#39;#width&#39;).textContent = canvas.width;
  document.querySelector(&#39;#height&#39;).textContent = canvas.height;
}

drawColorCubeImage(ctx, 8);
</code></pre>
<p>キャンバスが必要です。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-html">&lt;canvas&gt;&lt;/canvas&gt;
</code></pre>
<p>これで任意のサイズで同一性の3Dルックアップテーブルを生成できます。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2F3dlut-base-cube-maker.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../3dlut-base-cube-maker.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>解像度が大きいほど微調整が可能ですが、キューブのデータであるため必要なサイズはすぐに大きくなります。
サイズ8のキューブでは2KBしか必要ありませんが、サイズ64のキューブでは1MB必要です。
したがって、望む効果を再現する最小のものを使用して下さい。</p>
<p>サイズを16に設定しSaveをクリックすると以下のようなファイルができます。</p>
<div class="threejs_center"><img src="../resources/images/identity-lut-s16.png"></div>

<p>また、LUTを適用したい部分の画像キャプチャをする必要があります。
通常は上記のシーンを右クリックして &quot;名前を付けて保存... &quot;を選択できますが、<code class="notranslate" translate="no">OrbitControls</code> がOSによっては右クリック防止してるかもしれない事に注意して下さい。
私の場合は、スクリーンショットを取得するためにOSのスクリーンキャプチャ機能を使用しました。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-screen-capture.jpg" style="width: 600px"></div>

<p>次に画像エディタ（私の場合はPhotoshop）で上記の画像を読み込み、左上に3DLUTの画像を貼り付けます。</p>
<blockquote>
<p>備考: 最初にPhotoshop上でLUTファイルをドラッグ＆ドロップしてみましたが、上手くいきませんでした。
Photoshopで2倍の大きさにしてみました。
DPIか何かに合わせようとしているのかもしれません。
LUTファイルを個別に読み込み、コピーして画面キャプチャに貼り付けると上手くいきました。</p>
</blockquote>
<div class="threejs_center"><img src="../resources/images/3dlut-photoshop-before.jpg" style="width: 600px"></div>

<p>カラーベースのフルイメージ調整を使い画像調整します。
Photoshopの場合、使用できる調整のほとんどは画像 → 調整メニューにあります。</p>
<div class="threejs_center"><img src="../resources/images/3dlut-photoshop-after.jpg" style="width: 600px"></div>

<p>好みに合わせて画像を調整して、左上に配置した3DLUTスライスにも同じ調整が適用されているのが分かります。</p>
<p>分かりましたがどうやって使うのでしょうか？</p>
<p>最初にpngを<code class="notranslate" translate="no">3dlut-red-only-s16.png</code>で保存しました。
メモリを節約するために左上にLUTテーブルを16 x 256でトリミングしましたが、もっと楽しむためにロード後にトリミングしておきます。
これの良い点はpngファイルを見ると、LUTの効果をある程度把握できます。
悪い点はもちろん帯域の無駄遣いです。</p>
<p>以下はそれをロードするためのコードです。
このコードはテクスチャをすぐに使用できるように、同一性のLUTから始まります。
次に画像をロードし3D LUT部分だけをキャンバスにコピーします。
キャンバスからデータを取得してテクスチャに設定し、<code class="notranslate" translate="no">needsUpdate</code> をtrueに設定して新しいデータを取得させます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const makeLUTTexture = function() {
  const imgLoader = new THREE.ImageLoader();
  const ctx = document.createElement(&#39;canvas&#39;).getContext(&#39;2d&#39;);

  return function(info) {
    const texture = makeIdentityLutTexture(
        info.filter ? THREE.LinearFilter : THREE.NearestFilter);

    if (info.url) {
      const lutSize = info.size;

      // set the size to 2 (the identity size). We&#39;ll restore it when the
      // image has loaded. This way the code using the lut doesn&#39;t have to
      // care if the image has loaded or not
      info.size = 2;

      imgLoader.load(info.url, function(image) {
        const width = lutSize * lutSize;
        const height = lutSize;
        info.size = lutSize;
        ctx.canvas.width = width;
        ctx.canvas.height = height;
        ctx.drawImage(image, 0, 0);
        const imageData = ctx.getImageData(0, 0, width, height);

        texture.image.data = new Uint8Array(imageData.data.buffer);
        texture.image.width = width;
        texture.image.height = height;
        texture.needsUpdate = true;
      });
    }

    return texture;
  };
}();
</code></pre>
<p>先ほど作成したLUTのpngを読み込むのに使ってみましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutTextures = [
  { name: &#39;identity&#39;,           size: 2, filter: true , },
  { name: &#39;identity no filter&#39;, size: 2, filter: false, },
+  { name: &#39;custom&#39;,          url: &#39;resources/images/lut/3dlut-red-only-s16.png&#39; },
];

+lutTextures.forEach((info) =&gt; {
+  // if not size set get it from the filename
+  if (!info.size) {
+    // assumes filename ends in &#39;-s&lt;num&gt;[n]&#39;
+    // where &lt;num&gt; is the size of the 3DLUT cube
+    // and [n] means &#39;no filtering&#39; or &#39;nearest&#39;
+    //
+    // examples:
+    //    &#39;foo-s16.png&#39; = size:16, filter: true
+    //    &#39;bar-s8n.png&#39; = size:8, filter: false
+    const m = /-s(\d+)(n*)\.[^.]+$/.exec(info.url);
+    if (m) {
+      info.size = parseInt(m[1]);
+      info.filter = info.filter === undefined ? m[2] !== &#39;n&#39; : info.filter;
+    }
+  }
+
+  info.texture = makeLUTTexture(info);
+});
</code></pre>
<p>上記ではLUTのサイズをファイル名の最後にエンコードしてます。
これでLUTをpngとして渡すのが簡単になります。</p>
<p>既存のLUTのpngファイルをたくさん追加しておきましょう。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutTextures = [
  { name: &#39;identity&#39;,           size: 2, filter: true , },
  { name: &#39;identity no filter&#39;, size: 2, filter: false, },
  { name: &#39;custom&#39;,          url: &#39;resources/images/lut/3dlut-red-only-s16.png&#39; },
+  { name: &#39;monochrome&#39;,      url: &#39;resources/images/lut/monochrome-s8.png&#39; },
+  { name: &#39;sepia&#39;,           url: &#39;resources/images/lut/sepia-s8.png&#39; },
+  { name: &#39;saturated&#39;,       url: &#39;resources/images/lut/saturated-s8.png&#39;, },
+  { name: &#39;posterize&#39;,       url: &#39;resources/images/lut/posterize-s8n.png&#39;, },
+  { name: &#39;posterize-3-rgb&#39;, url: &#39;resources/images/lut/posterize-3-rgb-s8n.png&#39;, },
+  { name: &#39;posterize-3-lab&#39;, url: &#39;resources/images/lut/posterize-3-lab-s8n.png&#39;, },
+  { name: &#39;posterize-4-lab&#39;, url: &#39;resources/images/lut/posterize-4-lab-s8n.png&#39;, },
+  { name: &#39;posterize-more&#39;,  url: &#39;resources/images/lut/posterize-more-s8n.png&#39;, },
+  { name: &#39;inverse&#39;,         url: &#39;resources/images/lut/inverse-s8.png&#39;, },
+  { name: &#39;color negative&#39;,  url: &#39;resources/images/lut/color-negative-s8.png&#39;, },
+  { name: &#39;high contrast&#39;,   url: &#39;resources/images/lut/high-contrast-bw-s8.png&#39;, },
+  { name: &#39;funky contrast&#39;,  url: &#39;resources/images/lut/funky-contrast-s8.png&#39;, },
+  { name: &#39;nightvision&#39;,     url: &#39;resources/images/lut/nightvision-s8.png&#39;, },
+  { name: &#39;thermal&#39;,         url: &#39;resources/images/lut/thermal-s8.png&#39;, },
+  { name: &#39;b/w&#39;,             url: &#39;resources/images/lut/black-white-s8n.png&#39;, },
+  { name: &#39;hue +60&#39;,         url: &#39;resources/images/lut/hue-plus-60-s8.png&#39;, },
+  { name: &#39;hue +180&#39;,        url: &#39;resources/images/lut/hue-plus-180-s8.png&#39;, },
+  { name: &#39;hue -60&#39;,         url: &#39;resources/images/lut/hue-minus-60-s8.png&#39;, },
+  { name: &#39;red to cyan&#39;,     url: &#39;resources/images/lut/red-to-cyan-s8.png&#39; },
+  { name: &#39;blues&#39;,           url: &#39;resources/images/lut/blues-s8.png&#39; },
+  { name: &#39;infrared&#39;,        url: &#39;resources/images/lut/infrared-s8.png&#39; },
+  { name: &#39;radioactive&#39;,     url: &#39;resources/images/lut/radioactive-s8.png&#39; },
+  { name: &#39;goolgey&#39;,         url: &#39;resources/images/lut/googley-s8.png&#39; },
+  { name: &#39;bgy&#39;,             url: &#39;resources/images/lut/bgy-s8.png&#39; },
];
</code></pre>
<p>そして、ここにはたくさんのLUTがあります。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-postprocessing-3dlut.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-postprocessing-3dlut.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>最後にもう1つ、ただのお遊びですがAdobeが定義した標準LUTフォーマットがあります。
<a href="https://www.google.com/search?q=lut+files">ネットで検索するとたくさんのLUTファイル</a>が見つかります。</p>
<p>クイックローダーを書いてみました。
フォーマットの種類は4つありますが、残念ながら私は1種類の例しか見つけられなかったので、全ての種類が動作するかを簡単にテストできませんでした。</p>
<p>ドラッグ＆ドロップライブラリも書いてみます。
両方を使いAdobe LUTファイルをドラッグ＆ドロップして効果を確認できるようにしてみましょう。</p>
<p>まず2つのライブラリが必要です。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">import * as lutParser from &#39;./resources/lut-reader.js&#39;;
import * as dragAndDrop from &#39;./resources/drag-and-drop.js&#39;;
</code></pre>
<p>そして次のように利用できます。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">dragAndDrop.setup({msg: &#39;Drop LUT File here&#39;});
dragAndDrop.onDropFile(readLUTFile);

function ext(s) {
  const period = s.lastIndexOf(&#39;.&#39;);
  return s.substr(period + 1);
}

function readLUTFile(file) {
  const reader = new FileReader();
  reader.onload = (e) =&gt; {
    const type = ext(file.name);
    const lut = lutParser.lutTo2D3Drgb8(lutParser.parse(e.target.result, type));
    const {size, data, name} = lut;
    const texture = new THREE.DataTexture(data, size * size, size, THREE.RGBFormat);
    texture.minFilter = THREE.LinearFilter;
    texture.needsUpdate = true;
    texture.flipY = false;
    const lutTexture = {
      name: (name &amp;&amp; name.toLowerCase().trim() !== &#39;untitled&#39;)
          ? name
          : file.name,
      size: size,
      filter: true,
      texture,
    };
    lutTextures.push(lutTexture);
    lutSettings.lut = lutTextures.length - 1;
    updateGUI();
  };

  reader.readAsText(file);
}
</code></pre>
<p>新しいファイルを含むようにGUIを更新する必要があります。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">const lutSettings = {
  lut: lutNameIndexMap.thermal,
};
const gui = new GUI({ width: 300 });
gui.addFolder(&#39;Choose LUT or Drag&amp;Drop LUT File(s)&#39;);

let lutGUI;
function updateGUI() {
  makeLutNameIndexMap();
  if (lutGUI) {
    gui.remove(lutGUI);
  }
  lutGUI = gui.add(lutSettings, &#39;lut&#39;, lutNameIndexMap);
}
updateGUI();
</code></pre>
<p><a href="https://www.google.com/search?q=lut+files">Adobe LUTをダウンロード</a>し、下の例にドラッグ＆ドロップできます。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-postprocessing-3dlut-w-loader.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-postprocessing-3dlut-w-loader.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>Adobe LUTはWeb上のオンライン利用を想定して設計されていません。
これらは大きなファイルです。
下のサンプルの上にドラッグ＆ドロップしてサイズを選択し、&quot;Save... &quot;をクリックし小さなファイルに変換し、PNG形式で保存できます。</p>
<p>以下のサンプルは上記のコードを変更したものです。
背景の絵を描くだけでglTFファイルはありません。
同一性のLUT画像です。</p>
<p>この画像は上記スクリプトから作成された同一性のLUT画像です。
次に読み込まれたLUTファイルを適用するための効果を使用しているので、結果はLUTファイルをPNGとして再現するために必要な画像になります。</p>
<p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/threejs/resources/editor.html?url=/threejs/lessons/..%2Fthreejs-postprocessing-adobe-lut-to-png-converter.html"></iframe></div>
  <a class="threejs_center" href="/threejs/lessons/../threejs-postprocessing-adobe-lut-to-png-converter.html" target="_blank">ここをクリックして別のウィンドウで開きます</a>
</div>

</p>
<p>1つ解説を完全に飛ばしてるのは、シェーダー自体がどのように動作するかです。
将来的にはもう少しGLSLをカバーできると良いと思います。
今の所は興味があれば<a href="threejs-post-processing.html">ポストプロセスの記事</a>のリンクを見たり<a href="https://www.youtube.com/watch?v=rfQ8rKGTVlg#t=24m30s">この動画を見て下さい</a>。</p>
<script type="module" src="../resources/threejs-post-processing-3dlut.js"></script>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/threejs/lessons/threejs-post-processing-3dlut.html" >English</a>
    <option value="/threejs/lessons/fr/threejs-post-processing-3dlut.html" >Français</a>
    <option value="/threejs/lessons/ja/threejs-post-processing-3dlut.html" selected>日本語</a>
    <option value="/threejs/lessons/kr/threejs-post-processing-3dlut.html" >한국어</a>
    <option value="/threejs/lessons/ru/threejs-post-processing-3dlut.html" >Русский</a>
    <option value="/threejs/lessons/zh_cn/threejs-post-processing-3dlut.html" >中文</a>
</select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-fundamentals.html">基礎知識</a></li>
<li><a href="/threejs/lessons/ja/threejs-responsive.html">レスポンシブデザイン</a></li>
<li><a href="/threejs/lessons/ja/threejs-prerequisites.html">前提条件</a></li>
<li><a href="/threejs/lessons/ja/threejs-setup.html">セットアップ</a></li>
        </ul>
  <li>基礎</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-primitives.html">プリミティブ</a></li>
<li><a href="/threejs/lessons/ja/threejs-scenegraph.html">シーングラフ</a></li>
<li><a href="/threejs/lessons/ja/threejs-materials.html">マテリアル</a></li>
<li><a href="/threejs/lessons/ja/threejs-textures.html">テクスチャ</a></li>
<li><a href="/threejs/lessons/ja/threejs-lights.html">ライト</a></li>
<li><a href="/threejs/lessons/ja/threejs-cameras.html">カメラ</a></li>
<li><a href="/threejs/lessons/ja/threejs-shadows.html">Shadows</a></li>
<li><a href="/threejs/lessons/ja/threejs-fog.html">Fog</a></li>
<li><a href="/threejs/lessons/ja/threejs-rendertargets.html">Render Targets</a></li>
<li><a href="/threejs/lessons/ja/threejs-custom-geometry.html">Custom Geometry</a></li>
<li><a href="/threejs/lessons/ja/threejs-custom-buffergeometry.html">Custom BufferGeometry</a></li>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-rendering-on-demand.html">要求されたレンダリング</a></li>
<li><a href="/threejs/lessons/ja/threejs-debugging-javascript.html">JavaScriptのデバッグ</a></li>
<li><a href="/threejs/lessons/ja/threejs-debugging-glsl.html">GLSLのデバッグ</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#screenshot">スクリーンショットを撮る</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#preservedrawingbuffer">キャンバスがクリアされるのを防ぐ</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#tabindex">キャンバスからキーボード入力を取得する</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#transparent-canvas">キャンバスを透明にする</a></li>
<li><a href="/threejs/lessons/ja/threejs-tips.html#html-background">HTMLの背景にthree.jsを使う</a></li>
        </ul>
  <li>最適化</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-optimize-lots-of-objects.html">多くのオブジェクトを最適化</a></li>
<li><a href="/threejs/lessons/ja/threejs-optimize-lots-of-objects-animated.html">アニメーションする多くのオブジェクトを最適化</a></li>
<li><a href="/threejs/lessons/ja/threejs-offscreencanvas.html">Web WorkerでOffscreenCanvasを使用する</a></li>
        </ul>
  <li>解決策</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-load-obj.html">OBJファイルの読み込み</a></li>
<li><a href="/threejs/lessons/ja/threejs-load-gltf.html">GLTFファイルの読み込み</a></li>
<li><a href="/threejs/lessons/ja/threejs-backgrounds.html">背景やスカイボックスを追加する</a></li>
<li><a href="/threejs/lessons/ja/threejs-transparency.html">透明なオブジェクトの描画方法</a></li>
<li><a href="/threejs/lessons/ja/threejs-multiple-scenes.html">複数キャンバスと複数シーン</a></li>
<li><a href="/threejs/lessons/ja/threejs-picking.html">マウスでオブジェクトをピッキング</a></li>
<li><a href="/threejs/lessons/ja/threejs-post-processing.html">ポストプロセス</a></li>
<li><a href="/threejs/lessons/ja/threejs-post-processing-3dlut.html">エフェクトにLUTファイルを適用する</a></li>
<li><a href="/threejs/lessons/ja/threejs-shadertoy.html">Using Shadertoy shaders</a></li>
<li><a href="/threejs/lessons/ja/threejs-align-html-elements-to-3d.html">Aligning HTML Elements to 3D</a></li>
<li><a href="/threejs/lessons/ja/threejs-indexed-textures.html">Using Indexed Textures for Picking and Color</a></li>
<li><a href="/threejs/lessons/ja/threejs-canvas-textures.html">Using A Canvas for Dynamic Textures</a></li>
<li><a href="/threejs/lessons/ja/threejs-billboards.html">Billboards and Facades</a></li>
<li><a href="/threejs/lessons/ja/threejs-cleanup.html">Freeing Resources</a></li>
<li><a href="/threejs/lessons/ja/threejs-voxel-geometry.html">Making Voxel Geometry (Minecraft)</a></li>
<li><a href="/threejs/lessons/ja/threejs-game.html">Start making a Game.</a></li>
        </ul>
  <li>WebVR</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-webvr.html">VR - Basics</a></li>
<li><a href="/threejs/lessons/ja/threejs-webvr-look-to-select.html">VR - Look To Select</a></li>
<li><a href="/threejs/lessons/ja/threejs-webvr-point-to-select.html">VR - Point To Select</a></li>
        </ul>
  <li>参照</li>
        <ul>
          <li><a href="/threejs/lessons/ja/threejs-material-table.html">Material Table</a></li>
        </ul></ul>
<ul>
  <li><a href="https://github.com/gfxfundamentals/threejsfundamentals">github</a></li>
  <li><a href="https://threejs.org">three.js</a></li>
  <li><a href="https://threejs.org/docs/">three.jsドキュメント</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        <div>質問はありますか? <a href="http://stackoverflow.com/questions/tagged/three.js">何かあればstackoverflowで尋ねて下さい</a>.</div>
        <div>Issue/Bug? <a href="http://github.com/greggman/threefundamentals/issues">またはgithubでissueを作って下さい</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'threejsfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'Three.jsの3DLUTポストプロセス';
            var disqus_title = 'Three.jsの3DLUTポストプロセス';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("threejsfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "threejsfundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-3.3.1.slim.min.js"></script>
<script src="/threejs/lessons/resources/prettify.js"></script>
<script src="/threejs/lessons/resources/lesson.js"></script>
<script>
(function() {
  if (window.location.hostname.indexOf("threejsfundamentals.org") < 0) {
      return;
  }

  function addScript(src, fn) {
    const script = document.createElement('script');
    const firstScript = document.getElementsByTagName('script')[0];
    script.async = true;
    script.defer = true;
    if (fn) {
      script.addEventListener('load', fn);
    }
    script.src = src;
    firstScript.parentNode.insertBefore(script, firstScript);
  }

  addScript('//cdn.webglstats.com/stat.js');
  addScript('https://www.googletagmanager.com/gtag/js?id=UA-120733518-1', () => {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-120733518-1');
  });
}());
</script>


</html>



